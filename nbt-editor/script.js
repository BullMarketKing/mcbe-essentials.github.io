var file = {"type":"compound","name":"","value":{"format_version":{"type":"int","value":1},"size":{"type":"list","value":{"type":"int","value":[10,6,10]}},"structure":{"type":"compound","value":{"block_indices":{"type":"list","value":{"type":"list","value":[{"type":"int","value":[0,0,0,0,0,0,0,0,0,0,1,2,2,2,3,2,2,2,4,1,1,2,2,2,5,2,2,2,4,1,1,4,2,2,2,2,2,2,4,1,3,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,0,0,0,0,0,0,0,0,0,4,3,3,3,3,4,6,3,7,7,4,2,3,5,5,4,8,5,5,9,4,4,3,5,5,4,5,5,5,4,4,3,3,4,2,4,2,2,4,1,5,5,3,5,5,5,5,5,5,3,5,0,0,0,0,10,0,4,0,0,0,3,3,3,3,4,3,3,3,3,3,5,5,5,5,4,3,5,5,3,5,3,5,5,5,4,5,5,5,4,5,5,4,4,5,4,5,5,4,4,5,5,3,3,0,4,4,0,3,5,5,0,10,0,0,0,0,0,0,0,0,2,3,3,3,4,6,3,3,3,3,5,5,5,5,4,8,5,5,5,5,2,5,5,5,4,5,5,5,5,5,5,2,3,3,4,3,3,3,2,4,5,3,0,0,2,2,0,0,5,5,0,0,0,0,0,0,0,10,0,0,4,3,3,3,11,3,3,3,3,3,5,5,5,5,4,5,5,5,5,5,2,5,5,5,4,5,5,5,5,5,5,2,5,3,4,8,5,5,2,12,5,5,4,2,11,11,2,4,3,5,0,0,0,0,0,4,0,0,0,0,4,3,3,3,11,6,3,3,3,3,5,5,5,5,4,8,5,5,5,5,2,5,5,5,4,5,5,5,5,5,5,2,5,3,4,8,3,5,2,12,5,5,4,2,11,11,2,4,3,5,0,0,0,0,0,0,4,0,0,0,2,3,3,3,4,6,3,3,3,3,4,5,5,5,4,5,5,5,5,5,2,5,5,5,4,5,5,5,5,5,5,2,3,3,4,8,3,3,2,4,5,5,0,0,2,2,0,0,5,5,0,10,0,0,0,0,0,0,4,0,4,3,3,3,4,6,3,3,3,3,4,5,5,5,4,8,5,5,3,5,2,5,3,5,4,5,5,5,4,5,5,4,4,5,4,5,5,4,4,5,5,5,3,0,4,4,0,3,5,5,0,0,0,0,0,0,10,0,4,0,4,3,3,3,4,6,3,13,13,4,2,5,5,5,4,8,5,14,5,4,4,4,3,5,4,5,5,5,4,4,5,1,4,2,4,2,2,4,1,5,5,5,5,5,5,5,5,5,5,5,0,0,0,0,0,0,0,0,0,0,1,2,2,2,3,12,2,2,4,1,1,2,2,2,5,2,2,2,4,1,1,4,2,2,5,2,2,2,4,1,5,5,5,5,2,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5]},{"type":"int","value":[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]}]}},"entities":{"type":"list","value":{"type":"end","value":[]}},"palette":{"type":"compound","value":{"default":{"type":"compound","value":{"block_palette":{"type":"list","value":{"type":"compound","value":[{"name":{"type":"string","value":"minecraft:blackstone"},"states":{"type":"compound","value":{}},"version":{"type":"int","value":17825808}},{"name":{"type":"string","value":"minecraft:polished_basalt"},"states":{"type":"compound","value":{"pillar_axis":{"type":"string","value":"y"}}},"version":{"type":"int","value":17825808}},{"name":{"type":"string","value":"minecraft:polished_blackstone"},"states":{"type":"compound","value":{}},"version":{"type":"int","value":17825808}},{"name":{"type":"string","value":"minecraft:air"},"states":{"type":"compound","value":{}},"version":{"type":"int","value":17825808}},{"name":{"type":"string","value":"minecraft:polished_blackstone_bricks"},"states":{"type":"compound","value":{}},"version":{"type":"int","value":17825808}},{"name":{"type":"string","value":"minecraft:light_block"},"states":{"type":"compound","value":{"block_light_level":{"type":"int","value":15}}},"version":{"type":"int","value":17825808}},{"name":{"type":"string","value":"minecraft:chest"},"states":{"type":"compound","value":{"facing_direction":{"type":"int","value":3}}},"version":{"type":"int","value":17825808}},{"name":{"type":"string","value":"minecraft:chest"},"states":{"type":"compound","value":{"facing_direction":{"type":"int","value":5}}},"version":{"type":"int","value":17825808}},{"name":{"type":"string","value":"minecraft:wall_sign"},"states":{"type":"compound","value":{"facing_direction":{"type":"int","value":3}}},"version":{"type":"int","value":17825808}},{"name":{"type":"string","value":"minecraft:wall_sign"},"states":{"type":"compound","value":{"facing_direction":{"type":"int","value":5}}},"version":{"type":"int","value":17825808}},{"name":{"type":"string","value":"minecraft:gilded_blackstone"},"states":{"type":"compound","value":{}},"version":{"type":"int","value":17825808}},{"name":{"type":"string","value":"minecraft:chiseled_polished_blackstone"},"states":{"type":"compound","value":{}},"version":{"type":"int","value":17825808}},{"name":{"type":"string","value":"minecraft:gold_block"},"states":{"type":"compound","value":{}},"version":{"type":"int","value":17825808}},{"name":{"type":"string","value":"minecraft:chest"},"states":{"type":"compound","value":{"facing_direction":{"type":"int","value":4}}},"version":{"type":"int","value":17825808}},{"name":{"type":"string","value":"minecraft:wall_sign"},"states":{"type":"compound","value":{"facing_direction":{"type":"int","value":4}}},"version":{"type":"int","value":17825808}}]}},"block_position_data":{"type":"compound","value":{}}}}}}}},"structure_world_origin":{"type":"list","value":{"type":"int","value":[92,36,102]}}}};

var translatedInputs = {
  int: 'number',
  string: 'text',
  compound: 'compound',
  list: 'list'
};

function createNode(payload){
  if(payload.type == 'compound'){
    createCompound(payload)
  } else if(payload.type == 'list') {
    createList(payload)
  } else {
    createValue(payload)    
  }
}

function createCompound(payload){
  let elname = payload.name;
  let parent = payload.parent;
  let data = payload.data;
  let path = payload.path;
  if(payload.name === undefined){
    elname = 'file'
  } 
  if(!payload.parent){
    parent = document.getElementById("editor");
  } 
  
  var node = document.createElement("details");
  node.classList = ["nbt-details"];
  node.setAttribute("path", path);
  node.setAttribute("tabindex", "0");
  node.innerHTML = "<summary>"+ elname +"</summary>";
  if(data.constructor === Object){
    node.addEventListener("click", nodeCallback);
  } else {
    node.innerHTML += data;
  }
  
  parent.appendChild(node);
}

function createValue(payload) {
  var parent = document.getElementById("editor");
  if(payload.parent) parent = payload.parent
  
  var value = payload.data;
  if(payload.data.constructor == Object){
    //Part of a compound
    value = payload.data.value
  } else {
    //Standalone value, part of a list
    value = payload.data
  }
  
  var node = document.createElement("label");
  node.classList = ["nbt-value"];
  node.setAttribute("path", payload.path);
  node.setAttribute("tabindex", "0");
  node.innerHTML = "<span>" + payload.name + "</span>" + ": <input type='text' class='app-input' value='"+ value +"'>"
  
  payload.parent.appendChild(node)
}

function createList(payload) {  
  let elname = payload.name;
  let parent = payload.parent;
  let data = payload.data;
  let path = payload.path;
  if(payload.name === undefined){
    elname = 'file'
  } 
  if(!payload.parent){
    parent = document.getElementById("editor");
  } 
  
  //Get data of list and types of items
  //var listdata = payload.data.value.value;
  //var listitemtype = payload.data.value.type;
  
  var node = document.createElement("details");
  node.classList = ["nbt-details"];
  node.setAttribute("path", path);
  node.setAttribute("tabindex", "0");
  let summary = document.createElement("summary");
  summary.innerHTML = elname;
  node.appendChild(summary);
  let listel = document.createElement("ul");
  listel.classList = ["nbt-list"];
  
  //Register createChildren
  node.addEventListener("click", nodeCallback);
  
  node.appendChild(listel);
  parent.appendChild(node);
}

function nodeCallback(){
  if(!this.hasAttribute("completed")){
    createChildren(this.getAttribute("path"), this);
    this.setAttribute("completed", "true");
  }
}

function createChildren(path, element){  
  let data;
  try {
    data = eval(path);
  } catch (e) {
    console.error(e);
    return;
  }
  
  if(data.type == 'compound') {
    for(let childname of Object.keys(data.value)){
      let newpath = path + "['value']['"+ childname +"']";
      let newdata = data['value'][childname];
      createNode({
        path: newpath, 
        data: newdata,
        name: childname,
        parent: element,
        type: newdata.type
      });
    }
  } else if(data.type == 'list') {
    var listitemtype = data.value.type;
    var listdata = data.value.value;
    
    for(var i = 0; i < listdata.length; i++){
      var pl = {
        path: path + "['value']['value']["+i+"]",
        data: listdata[i],
        name: i,
        parent: element.querySelector(".nbt-list"),
        type: listitemtype,
      };
      console.log(pl)
      createNode(pl)
    }
  } else {
    //The given path contains
    console.log(path);
  }
}


createNode({path: 'file', data: file, name: 'file', type: 'compound'});